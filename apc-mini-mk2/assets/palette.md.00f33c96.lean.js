import{C as x,c as v,u as f,A as k,S as g,V as m,a as w,T as c,b as _}from"./chunks/APC.9ecbd7d2.js";import{_ as E,r as y,o as b,c as p,b as C}from"./chunks/framework.2d9ebef7.js";class B{constructor(t,o){this.states=t,this.currentState=o,this.mk2=null}attach(t){this.mk2=t,this.onEvt=this.onEvt.bind(this),document.addEventListener("noteon",this.onEvt),document.addEventListener("noteoff",this.onEvt),document.addEventListener("cc",this.onEvt)}detach(){document.removeEventListener("noteon",this.onEvt),document.removeEventListener("noteoff",this.onEvt),document.removeEventListener("cc",this.onEvt)}go(t){this.currentState=this.states[t]}onEvt(t){if(t.controller!=this.mk2||!this.currentState)return;let{key:o,type:n}=t,s=this.currentState;s.handlers[n]&&(Object.bind(this,s.handlers[n]),s.handlers[n](t)),n=="noteon"&&s.handlers[o]&&(Object.bind(this,s.handlers[o]),s.handlers[o](t))}}let d=new B({paletteBrowser:{handlers:{noteon(e){console.log("eeeeeeeeeee i'm a note on")},leftButton(){console.log("eeeeeeeeeee i'm a button left"),this.paletteCursor-=1},rightButton(){this.paletteCursor+=1}},render(){}}}),r={};x.forEach((e,t)=>{if(r[e]==null){let o=v(e);r[e]={color:e,hsl:o.hsl(),idx:t,contrast:o.luminance()>.5?"#000":"#fff"}}});r=Object.values(r);r=f.sort(r,e=>[e.hsl[0]||0,e.hsl[1],-e.hsl[2]]);const P={name:"Palette",components:{APC:k},data(){return{sortedColors:[],selectedColors:[],currentBlock:null,currentColor:null,mk2:null,mousedown:!1,colorgrid:f.range(64).map(e=>{let t=e%8,o=Math.trunc(e/8);return{idx:e,x:t,y:o,color:"#000000",colorIdx:0}}),allColors:r,byIdx:Object.fromEntries(r.map(e=>[e.idx,e])),direction:0,canvas:null}},methods:{setColor(e,t){if(t!==void 0&&!this.mousedown)return;this.currentColor=e;let o=this.currentBlock;o.colorObj=e,o.colorIdx=e.idx,o.color=e.color,o.contrast=e.contrast,mk2[`pad${o.x}${o.y}`]=e.idx},fillColors(e,t,o,n){o.forEach((s,i)=>{let l=e+(n?0:i),u=t+(n?i:0);this.mk2[`pad${l}${u}`].color=[s,6];let a=this.byIdx[s],h=this.colorgrid[u*8+l];h.colorObj=a,h.colorIdx=a.idx,h.color=a.color,h.contrast=a.contrast})},onColorMouseDown(e){this.mousedown=!0,this.setColor(e);let t=()=>{this.mousedown=!1,document.removeEventListener("mouseup",t)};document.addEventListener("mouseup",t)},selectBlock(e){var t;this.currentBlock=e,(t=e.colorObj)!=null&&t.color&&(this.currentColor=e.colorObj)},onDocumentKeyDown(e){let t=e.key;if(!this.currentBlock)return;let o=i=>{let l=this.allColors.indexOf(this.currentColor);l=Math.max(0,Math.min(this.allColors.length-1,l+i)),this.setColor(this.allColors[l])},n=i=>{let l=this.colorgrid.indexOf(this.currentBlock);l=Math.max(0,Math.min(this.colorgrid.length-1,l+i)),this.selectBlock(this.colorgrid[l])},s={Backspace:()=>{this.setColor({})},"[":()=>o(-1),"]":()=>o(1),ArrowUp:()=>n(-8),ArrowDown:()=>n(8),ArrowLeft:()=>n(-1),ArrowRight:()=>n(1)};s[t]?(e.preventDefault(),s[t]()):console.log(t)},handleAPC(e){e.key=="volumeButton"?this.mk2.reset():e.button.type=="rgb"?e.button.color=e.button.color=="#ffffff"?0:"#ffffff":e.key=="panButton"?this.canvas.x==4?(this.canvas.x=0,this.canvas.width=8,this.mk2.panButton.toggled=!0):(this.canvas.x=4,this.canvas.width=4,this.mk2.panButton.toggled=!1,this.mk2.select(0,2,3,7).forEach(t=>{t.color=0})):e.key=="fader0"&&(this.direction=(e.value/127-.5)*.5,console.log(this.direction))}},async mounted(){let e=new g({}),t=new m({x:0,y:0,width:8,height:8,bg:"#666666"});this.canvas=new m({x:1,y:2,width:6,height:5,bg:"#050505"}),this.label=new w(0,0),this.label.addChild(new c(0,0,"R","#ff0000")),this.label.addChild(new c(this.label.bounds.x+2,0,"G","#00ff00")),this.label.addChild(new c(this.label.bounds.x+2,0,"B","#0000ff")),this.label.addChild(new c(this.label.bounds.x+4,0,"Monster","#ffffff")),this.canvas.addChild(this.label),t.addChild(this.canvas),e.addChild(t),this.mk2=new _,await this.mk2.connect({sysex:!0,beforePaint:()=>{this.label.x+=this.direction,this.direction<0&&this.label.x<-this.label.bounds.x-2?this.label.x=10:this.direction>0&&this.label.x>10&&(this.label.x=-this.label.bounds.x-2);for(let o of e.getAllPixels())this.mk2.pads(o.x,o.y).color=o.color}}),d.attach(this.mk2),d.go("paletteBrowser"),document.addEventListener("noteon",this.handleAPC),document.addEventListener("cc",this.handleAPC),this.mk2.volumeButton.toggled=!0,this.mk2.muteButton.toggled=!0,document.addEventListener("keydown",this.onDocumentKeyDown)},beforeUnmount(){this.mk2.disconnect(),d.detach(),document.removeEventListener("noteon",this.handleAPC),document.removeEventListener("cc",this.handleAPC),document.removeEventListener("keydown",this.onDocumentKeyDown)}},A={class:"page palette"};function L(e,t,o,n,s,i){const l=y("APC");return b(),p("div",A,[C(l)])}const O=E(P,[["render",L]]),$=JSON.parse('{"title":"Fill Colors etc","description":"","frontmatter":{"title":"Fill Colors etc"},"headers":[],"relativePath":"palette.md","filePath":"palette.md"}'),D={name:"palette.md"},S=Object.assign(D,{setup(e){return(t,o)=>(b(),p("div",null,[C(O)]))}});export{$ as __pageData,S as default};
